# &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;神经情感分析
&emsp;&emsp;在这一章中，我们将讨论自然语言处理中最热门和最流行的应用之一，即情感分析。现在大多数人都是通过社交媒体平台来表达自己对某件事情的看法，而利用这海量的文字来记录客户对某件事情的满意度对于公司甚至政府来说都是非常重要的。<br>
&emsp;&emsp;在本章中，我们将使用递归式神经网络来建立情感分析的解决方案。本章将讨论以下主题:<br>
&emsp;&emsp;通用的情感分析架构<br>
&emsp;&emsp;情感分析-模型实现<br>
## 通用的情感分析架构
&emsp;&emsp;在本节中，我们将重点讨论可用于情感分析的通用深度学习体系结构。下图显示了构建情感分析模型所需的处理步骤。<br>
&emsp;&emsp;首先，我们要讲的是自然语言:<br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;![image](https://github.com/computeryanjiusheng2018/infodlt/blob/master/content/chapter12/chapter12_image/image022.png)<br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;图1„情绪分析解决方案的通用管道模型甚至说是自然语言的解决方案<br>
&emsp;&emsp;我们将使用电影评论作为素材来构建这个情感分析应用程序。这个应用程序的目标是基于输入的原始文本来产生这个观点是否积极的判断。例如，如果原始文本类似于“这部电影很好”，那么我们需要模型为它产生积极的情绪。<br>
&emsp;&emsp;情感分析应用程序将带领我们完成许多处理步骤，这些步骤是在神经网络中使用自然人类语言所必需的，比如嵌入。<br>
&emsp;&emsp;在这种情况下，我们有一个原始文本，例如，这不是一个好电影!那么我们最终想要得到的是这到底是一种消极的情绪还是积极的情绪。<br>
&emsp;&emsp;这类应用程序有几个难点:<br>
&emsp;&emsp;其中之一就是序列可能有不同的长度。这是一个很短的例子，但是我们会看到另外一个超过500字文本的例子。<br>
&emsp;&emsp;另一个问题是，如果我们只看单个单词(比如good)，那就表明了积极的情绪。然而，它的前面是not，所以现在它表示的是一个负面情绪。这可能会使情况变得更加复杂，之后我们将看到一个示例。<br>
&emsp;&emsp;正如我们在前一章中学到的，神经网络不能处理原始文本，因此我们需要首先将其转换成所谓的标记。这些基本上都是整数值，所以我们遍历整个数据集，来计算每个单词被使用的次数。然后，我们制作一个词汇表，每个单词在这个词汇表中得到一个索引。比如这个单词有整数ID或标记的是11，这个单词标记的是6，而不是标记的21，等等。至此，我们已经将原始文本转换为一个名为token的整数列表。但神经网络仍然不能对这些数据进行操作，因为如果我们有10,000个词汇表，这些标记可以取0到9999之间的值，但它们之间可能根本不相关。所以很显然，数字998可能与数字999有完全不同的语义含义。<br>
&emsp;&emsp;因此，我们将使用我们在上一章学到的表示学习或嵌入的思想。该嵌入层将整数标记转换为实值向量，因此标记11成为向量[0.67,0.36，…，0.39]，如图1所示。对于下一个标记6也是一样。<br>
&emsp;&emsp;简单回顾一下我们在上一章所学习的内容:前面图中的嵌入层习得了标记和它们对应的实值向量之间的映射。同时，嵌入层习得单词的语义，使具有相似含义的单词在这个嵌入的空间中比较接近。<br>
&emsp;&emsp;从输入的原始文本中，我们得到一个二维矩阵，或者张量，现在可以输入到递归神经网络(递归神经网络)。这样就可以处理任意长度的序列，然后将该网络的输出值输入到一个具有sigmoid激活函数的全连接层或致密层。因此，输出值介于0和1之间，其中0的值表示负面情绪。但如果sigmoid函数的值既不是0也不是1呢?然后我们需要在中间引入一个临界值或阈值，这样如果这个值低于0.5，那么相应的输入就会被认为是负面情绪，超过这个临界值的值就会被认为是正面情绪。<br>
## 递归神经网络--情感分析语境
&emsp;&emsp;现在，让我们回顾一下递归神经网络的基本概念并在情感分析应用的背景下讨论它们。正如我们在递归神经网络章节中提到的，递归神经网络的基本构件是一个循环单元，如图所示:<br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;![image](https://github.com/computeryanjiusheng2018/infodlt/blob/master/content/chapter12/chapter12_image/image023.png)<br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;图2„递归神经网络的一个抽象概念<br>
&emsp;&emsp;这个图是对循环单元内发生的事情的抽象表示。这里输入一个单词，比如“好”。当然，它必须转换成嵌入向量。然而，我们现在将忽略这一点。另外，这个单元有一种内存状态，根据这个内容的状态和输入，我们将更新这个状态并将新数据写入状态例如，假设我们以前在输入中见过“不”这个词;我们将其写入状态是为了当我们在下面的输入中看到“好”这个词的时候，能知道我们刚刚从状态那里看到了“不”这个词。现在，我们看到了“好”这个词。因此, 当我们看到“不好”这两个词的组合时，我们就必须写入状态,即这可能表明,整个输入的文本可能具有负面情绪。从旧状态到新状态的内容的映射是通过所谓的门来完成的，这些实现的方式在不同版本的循环单元中是不同的。它基本上是一个带激活函数的矩阵运算，但是我们马上就会看到，其中含有一个反向传播梯度的问题。因此，递归神经网络必须以一种特殊的方式来设计，这样梯度才不会扭曲太多。<br>
&emsp;&emsp;在一个循环单元中，我们有一个类似的生成输出的门，再一次，循环单元的输出取决于状态的当前内容和我们看到的输入。所以我们可以尝试做的是展开一个循环单元的处理过程:<br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;![image](https://github.com/computeryanjiusheng2018/infodlt/blob/master/content/chapter12/chapter12_image/image024.png)<br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;图3„展开版的递归神经网络<br>
&emsp;&emsp;现在，我们得到的只是一个循环单元，但是流程图显示了在不同的时间阶段发生了什么。所以:<br>
&emsp;&emsp;在时间步骤1中，我们将单词this输入到循环单元，它的内部内存状态初始化为0。这是由TensorFlow在我们开始处理新数据序列时完成的。我们看到了this这个词循环单位状态是0。因此，我们使用内部门来更新内存状态，然后this在第2步中输入is这个词的时候被使用，现在，内存状态有一些内容。this这个词没有太多意义，所以状态可能还是0左右。<br>
&emsp;&emsp;is中也没有太多意义，所以状态可能还是0。<br>
&emsp;&emsp;在接下来的步骤中，我们看到的单词not，这意味着我们最终想要预测的，这是整个输入文本的情感。这是我们需要存储在内存中的东西，这样循环单元内的门会发现状态可能已经包含一些接近零的值。但现在它想存储我们刚刚看到的单词not，所以它在这种状态下保存了一些非零值。<br>
&emsp;&emsp;然后，我们继续下一个时间步骤，我们有单词a;这也没有太多的信息，所以它可能被忽略了。它只是在状态内复制。<br>
&emsp;&emsp;现在，我们有了“very”这个词，这表明，无论存在何种情绪，都可能是一种强烈的情绪，因此，循环单元现在知道，我们已经知道了单词not和very。它以某种方式将其存储在内存状态中。<br>
&emsp;&emsp;在接下来的时间里，我们看到了单词good，所以现在递归神经网络知道了not very good三个词，它想，哦，这可能是一个负面情绪!因此，它将该值存储在内部状态中。然后，在最后的步骤中，我们看到了movie这个单词，这和情绪没有实际联系，所以它可能会被忽略了。<br>
&emsp;&emsp;接下来，我们使用循环单元内的另一个门输出内存状态的内容，然后用sigmoid函数处理它(我们在这里不展示)。输出值在0到1之间。<br>
&emsp;&emsp;我们的想法是，我们想要从互联网电影数据库中成千上万的电影评论例子中训练这个神经网络，在那里，对于每个输入文本，我们给它的真正情感价值是积极或消极的。然后，我们希望TensorFlow找出循环单元内部的门存储的应该是什么，这样他们就能准确地从输入文本反映出正确的情感:<br>
